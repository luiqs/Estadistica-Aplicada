Conociendo al Paquete dplyr
================

# A. Instalación del paquete dplyr

Instalamos el paquete dplyr a través del interfaz de RStudio o con la
función install.packages(""). Luego activamos el paquete con la
siguiente función:

``` r
library(dplyr)
```

    ## 
    ## Attaching package: 'dplyr'

    ## The following objects are masked from 'package:stats':
    ## 
    ##     filter, lag

    ## The following objects are masked from 'package:base':
    ## 
    ##     intersect, setdiff, setequal, union

Una vez instalado podemos utilizar todas las funciones que se encuentran
dentro del paquete dplyr. Como hemos explicado en clase, este paquete es
utilizado para ordenar y manipular bases de dato. Aprendiendo a utilizar
alguna de sus principales funciones facilitará tener un total control
sobre los datos para su posterior análisis.

A manera de ejemplo vamos a trabajar con diferentes bases de datos para
aprender a utilizar las principales funciones del paquete “dplyr”.
Cargamos la base de datos de “starwars”

``` r
data("starwars")

starwars
```

    ## # A tibble: 87 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 R2-D2     96    32 <NA>       white, bl~ red             33   none  mascu~
    ##  4 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Leia~    150    49 brown      light      brown           19   fema~ femin~
    ##  6 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  7 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  8 R5-D4     97    32 <NA>       white, red red             NA   none  mascu~
    ##  9 Bigg~    183    84 black      light      brown           24   male  mascu~
    ## 10 Obi-~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Dentro del paquete “dplyr” vamos a concentrarnos en 6 funciones
principales o “mas usadas”, las cuales son: 1. filter() -&gt; filtrar
observaciones a partir de valores concretos 2. arrange() -&gt; re
ordenar las filas 3. select() -&gt; seleccionar variables por sus
nombres 4. mutate() -&gt; crea nuevas variables con funciones a partir
de las existentes 5. summarise() -&gt; colapsar varios valores para dar
un resumen de los mismos 6. group\_by() -&gt; opera la función a la que
acompaña grupo a grupo 7. rename() -&gt; Nos permite cambiar el nombre
de las variables

## 1. Funcion filter()

Recordamos en primero lugar los operadores lógicos que se vieron en
clase:

-   **&gt;** : Mayor

-   **&lt;** : Menor

-   = : Mayor e igual

-   &lt;=: Menor e igual

-   ==: Igual

-   !=: Diferente

Si queremos todos los personajes con ojos de color azul de las sagas de
las películas star wars utilizaríamos la función filter() con los
argumentos a continuación (el resultado de este filtrado se almacenará
en una nueva variables llamada "Starwars\_ojos\_azules)

``` r
Starwars_ojos_azules <- dplyr::filter(starwars, eye_color == "blue")

Starwars_ojos_azules
```

    ## # A tibble: 19 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172  77   blond      fair       blue            19   male  mascu~
    ##  2 Owen~    178 120   brown, gr~ light      blue            52   male  mascu~
    ##  3 Beru~    165  75   brown      light      blue            47   fema~ femin~
    ##  4 Anak~    188  84   blond      fair       blue            41.9 male  mascu~
    ##  5 Wilh~    180  NA   auburn, g~ fair       blue            64   male  mascu~
    ##  6 Chew~    228 112   brown      unknown    blue           200   male  mascu~
    ##  7 Jek ~    180 110   brown      fair       blue            NA   male  mascu~
    ##  8 Lobot    175  79   none       light      blue            37   male  mascu~
    ##  9 Mon ~    150  NA   auburn     fair       blue            48   fema~ femin~
    ## 10 Qui-~    193  89   brown      fair       blue            92   male  mascu~
    ## 11 Fini~    170  NA   blond      fair       blue            91   male  mascu~
    ## 12 Ric ~    183  NA   brown      fair       blue            NA   <NA>  <NA>  
    ## 13 Adi ~    184  50   none       dark       blue            NA   fema~ femin~
    ## 14 Mas ~    196  NA   none       blue       blue            NA   male  mascu~
    ## 15 Clie~    183  NA   brown      fair       blue            82   male  mascu~
    ## 16 Lumi~    170  56.2 black      yellow     blue            58   fema~ femin~
    ## 17 Barr~    166  50   black      yellow     blue            40   fema~ femin~
    ## 18 Joca~    167  NA   white      fair       blue            NA   fema~ femin~
    ## 19 Tarf~    234 136   brown      brown      blue            NA   male  mascu~
    ## # ... with 5 more variables: homeworld <chr>, species <chr>, films <list>,
    ## #   vehicles <list>, starships <list>

De igual manera, es importante recordar los operadores de álgebra
boleana vistos en clase teórica. Siendo x e y dos variables:

-   Operador & : y & x
-   Operador & + operador logico !: x & y
-   Operador o : x \| y
-   Operador xor: xor(x,y) es la unión exclusiva, lo que no es de x ni
    de y
-   Operador %in% : variable almacenada en un vector

### 1.1 Filtrando variables cualitativas

Podemos filtrar de frente sin almacenar los resultados en una nueva
variable

``` r
dplyr::filter(starwars, eye_color == "blue")
```

    ## # A tibble: 19 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172  77   blond      fair       blue            19   male  mascu~
    ##  2 Owen~    178 120   brown, gr~ light      blue            52   male  mascu~
    ##  3 Beru~    165  75   brown      light      blue            47   fema~ femin~
    ##  4 Anak~    188  84   blond      fair       blue            41.9 male  mascu~
    ##  5 Wilh~    180  NA   auburn, g~ fair       blue            64   male  mascu~
    ##  6 Chew~    228 112   brown      unknown    blue           200   male  mascu~
    ##  7 Jek ~    180 110   brown      fair       blue            NA   male  mascu~
    ##  8 Lobot    175  79   none       light      blue            37   male  mascu~
    ##  9 Mon ~    150  NA   auburn     fair       blue            48   fema~ femin~
    ## 10 Qui-~    193  89   brown      fair       blue            92   male  mascu~
    ## 11 Fini~    170  NA   blond      fair       blue            91   male  mascu~
    ## 12 Ric ~    183  NA   brown      fair       blue            NA   <NA>  <NA>  
    ## 13 Adi ~    184  50   none       dark       blue            NA   fema~ femin~
    ## 14 Mas ~    196  NA   none       blue       blue            NA   male  mascu~
    ## 15 Clie~    183  NA   brown      fair       blue            82   male  mascu~
    ## 16 Lumi~    170  56.2 black      yellow     blue            58   fema~ femin~
    ## 17 Barr~    166  50   black      yellow     blue            40   fema~ femin~
    ## 18 Joca~    167  NA   white      fair       blue            NA   fema~ femin~
    ## 19 Tarf~    234 136   brown      brown      blue            NA   male  mascu~
    ## # ... with 5 more variables: homeworld <chr>, species <chr>, films <list>,
    ## #   vehicles <list>, starships <list>

Vamos a trabajar así para los siguientes ejercicios.

Si queremos filtrar los personajes con color de ojos azules y amarillos

``` r
dplyr::filter(starwars, eye_color == "blue" | eye_color == "yellow")
```

    ## # A tibble: 30 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  4 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  5 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  6 Anak~    188    84 blond      fair       blue            41.9 male  mascu~
    ##  7 Wilh~    180    NA auburn, g~ fair       blue            64   male  mascu~
    ##  8 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ##  9 Jek ~    180   110 brown      fair       blue            NA   male  mascu~
    ## 10 Palp~    170    75 grey       pale       yellow          82   male  mascu~
    ## # ... with 20 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Si lo intentáramos de la siguiente manera…

dplyr::filter(starwars, eye\_color == “blue” \| “yellow”)

…No funcionaria, ya que el lenguaje de programación R no esta diseñado
de esta manera. Para esos casos se utiliza el operador %in%, y se debe
agrupar los colores de colores que queramos filtrar en un vector:

``` r
dplyr::filter(starwars, eye_color %in% c("blue","yellow"))
```

    ## # A tibble: 30 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  4 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  5 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  6 Anak~    188    84 blond      fair       blue            41.9 male  mascu~
    ##  7 Wilh~    180    NA auburn, g~ fair       blue            64   male  mascu~
    ##  8 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ##  9 Jek ~    180   110 brown      fair       blue            NA   male  mascu~
    ## 10 Palp~    170    75 grey       pale       yellow          82   male  mascu~
    ## # ... with 20 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

El operador %in% es muy utilizado cuando queremos incluir varias
categorías de una variable en una linea de código simple. Si quisiéramos
filtrar mas de dos colores de ojos

``` r
filter(starwars, eye_color %in% c("blue","yellow","red"))
```

    ## # A tibble: 35 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 R2-D2     96    32 <NA>       white, bl~ red             33   none  mascu~
    ##  4 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  6 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  7 R5-D4     97    32 <NA>       white, red red             NA   none  mascu~
    ##  8 Anak~    188    84 blond      fair       blue            41.9 male  mascu~
    ##  9 Wilh~    180    NA auburn, g~ fair       blue            64   male  mascu~
    ## 10 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ## # ... with 25 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

### 1.2 Filtrando variables cuantitativas

Las variables cuantitativas nos permiten hacer filtrados mas avanzados
ya que nos permiten jugar con los valores **mayores** y **menores**. Por
ejemplo, si quisiéramos filtrar a todos los personajes con un peso
corporal mayor a 80 kilogramos:

``` r
filter(starwars, mass > 80)
```

    ## # A tibble: 21 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  2 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  3 Bigg~    183    84 black      light      brown           24   male  mascu~
    ##  4 Anak~    188    84 blond      fair       blue            41.9 male  mascu~
    ##  5 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ##  6 Jabb~    175  1358 <NA>       green-tan~ orange         600   herm~ mascu~
    ##  7 Jek ~    180   110 brown      fair       blue            NA   male  mascu~
    ##  8 IG-88    200   140 none       metal      red             15   none  mascu~
    ##  9 Bossk    190   113 none       green      red             53   male  mascu~
    ## 10 Ackb~    180    83 none       brown mot~ orange          41   male  mascu~
    ## # ... with 11 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

![](JabbaPromo.png) Podemos ser mas específicos en nuestro filtrado, por
ejemplo si queremos seleccionar un intervalo de pesos. Seleccionando los
personajes que se encuentran entre los pesos de 60 a 80 kilogramos.

``` r
filter(starwars, mass >60 & mass < 80)
```

    ## # A tibble: 15 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172  77   blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167  75   <NA>       gold       yellow         112   none  mascu~
    ##  3 Beru~    165  75   brown      light      blue            47   fema~ femin~
    ##  4 Obi-~    182  77   auburn, w~ fair       blue-gray       57   male  mascu~
    ##  5 Gree~    173  74   <NA>       green      black           44   male  mascu~
    ##  6 Wedg~    170  77   brown      fair       hazel           21   male  mascu~
    ##  7 Palp~    170  75   grey       pale       yellow          82   male  mascu~
    ##  8 Boba~    183  78.2 black      fair       brown           31.5 male  mascu~
    ##  9 Land~    177  79   black      dark       brown           31   male  mascu~
    ## 10 Lobot    175  79   none       light      blue            37   male  mascu~
    ## 11 Nien~    160  68   none       grey       black           NA   male  mascu~
    ## 12 Jar ~    196  66   none       orange     orange          52   male  mascu~
    ## 13 Ben ~    163  65   none       grey, gre~ orange          NA   male  mascu~
    ## 14 Jang~    183  79   black      tan        brown           66   male  mascu~
    ## 15 Raym~    188  79   brown      light      brown           NA   male  mascu~
    ## # ... with 5 more variables: homeworld <chr>, species <chr>, films <list>,
    ## #   vehicles <list>, starships <list>

Se pueden de esta manera crear múltiples grupos de datos para su
análisis particular. Incluso se pueden filtrar dos variables al mismo
tiempo. Combinamos por ejemplo y filtramos los personajes con un peso
menor a 80 Kg y con ojos azules:

``` r
filter(starwars, mass < 80,
       eye_color == "blue")
```

    ## # A tibble: 6 x 14
    ##   name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##   <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ## 1 Luke~    172  77   blond      fair       blue              19 male  mascu~
    ## 2 Beru~    165  75   brown      light      blue              47 fema~ femin~
    ## 3 Lobot    175  79   none       light      blue              37 male  mascu~
    ## 4 Adi ~    184  50   none       dark       blue              NA fema~ femin~
    ## 5 Lumi~    170  56.2 black      yellow     blue              58 fema~ femin~
    ## 6 Barr~    166  50   black      yellow     blue              40 fema~ femin~
    ## # ... with 5 more variables: homeworld <chr>, species <chr>, films <list>,
    ## #   vehicles <list>, starships <list>

Las posibilidades son infinitas como en cualquier sistema de filtrado.
Se filtran los valore que nos permitan estudiar la base de datos de
mejor manera o que nos permita trabajar con los datos en los que estamos
interesados evaluar y analizar.

Nota: Es importante tener cuidado con los valores NA, que significa
ausencia de valor para la variable “x” y el individuo “z”. Estas muchas
veces no serán computadas en las operaciones o no permitirán reproducir
el código. Veremos mas adelante como tratar estas variables.

## 2. Función arrange()

La función arrange() del paquete dplyr nos ayuda a ordenar nuestra base
de datos en orden alfabético o por valores de números (del mayor al
menor o viceversa).

### 2.1 Arreglando variables cualitativas

Para ordenar por ejemplo a los personajes por el color de sus ojos:

``` r
dplyr::arrange(starwars, eye_color)
```

    ## # A tibble: 87 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Gree~    173    74 <NA>       green      black             44 male  mascu~
    ##  2 Nien~    160    68 none       grey       black             NA male  mascu~
    ##  3 Gasg~    122    NA none       white, bl~ black             NA male  mascu~
    ##  4 Kit ~    196    87 none       green      black             NA male  mascu~
    ##  5 Plo ~    188    80 none       orange     black             22 male  mascu~
    ##  6 Lama~    229    88 none       grey       black             NA male  mascu~
    ##  7 Taun~    213    NA none       grey       black             NA fema~ femin~
    ##  8 Shaa~    178    57 none       red, blue~ black             NA fema~ femin~
    ##  9 Tion~    206    80 none       grey       black             NA male  mascu~
    ## 10 BB8       NA    NA none       none       black             NA none  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Arregla la base de datos de acuerdo al color de ojos y en función del
orden del alfabeto. Adicionalmente, podemos colocar mas de una sola
variable, para que nos ordene no solo por el color de ojos, sino también
por el genero de cada personaje (siempre hay que separar las variables
por una “,”).

``` r
dplyr::arrange(starwars, eye_color, gender)
```

    ## # A tibble: 87 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Taun~    213    NA none       grey       black             NA fema~ femin~
    ##  2 Shaa~    178    57 none       red, blue~ black             NA fema~ femin~
    ##  3 Gree~    173    74 <NA>       green      black             44 male  mascu~
    ##  4 Nien~    160    68 none       grey       black             NA male  mascu~
    ##  5 Gasg~    122    NA none       white, bl~ black             NA male  mascu~
    ##  6 Kit ~    196    87 none       green      black             NA male  mascu~
    ##  7 Plo ~    188    80 none       orange     black             22 male  mascu~
    ##  8 Lama~    229    88 none       grey       black             NA male  mascu~
    ##  9 Tion~    206    80 none       grey       black             NA male  mascu~
    ## 10 BB8       NA    NA none       none       black             NA none  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Sin embargo, realizar arreglos de varias variables al mismo tiempo puede
resultar algo confuso de interpretar. Siempre la primera variable que
pongamos prevalecerá en jerarquía.

### 2.2 Arreglando variables cuantitativas

Para ordenar por ejemplo a los personajes de starwars por su peso
corporal utilizamos el siguiente código:

``` r
dplyr::arrange(starwars, mass)
```

    ## # A tibble: 87 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Ratt~     79    15 none       grey, blue unknown           NA male  mascu~
    ##  2 Yoda      66    17 white      green      brown            896 male  mascu~
    ##  3 Wick~     88    20 brown      brown      brown              8 male  mascu~
    ##  4 R2-D2     96    32 <NA>       white, bl~ red               33 none  mascu~
    ##  5 R5-D4     97    32 <NA>       white, red red               NA none  mascu~
    ##  6 Sebu~    112    40 none       grey, red  orange            NA male  mascu~
    ##  7 Dud ~     94    45 none       blue, grey yellow            NA male  mascu~
    ##  8 Padm~    165    45 brown      light      brown             46 fema~ femin~
    ##  9 Wat ~    193    48 none       green, gr~ unknown           NA male  mascu~
    ## 10 Sly ~    178    48 none       pale       white             NA <NA>  <NA>  
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Esto automáticamente podemos observar que coloca a todos los personajes
del mas liviano al mas pesado. Si quisiéramos el efecto contrario
utilizaríamos dentro del argumento la función desc():

``` r
dplyr::arrange(starwars, desc(mass))
```

    ## # A tibble: 87 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Jabb~    175  1358 <NA>       green-tan~ orange         600   herm~ mascu~
    ##  2 Grie~    216   159 none       brown, wh~ green, y~       NA   male  mascu~
    ##  3 IG-88    200   140 none       metal      red             15   none  mascu~
    ##  4 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Tarf~    234   136 brown      brown      blue            NA   male  mascu~
    ##  6 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  7 Bossk    190   113 none       green      red             53   male  mascu~
    ##  8 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ##  9 Jek ~    180   110 brown      fair       blue            NA   male  mascu~
    ## 10 Dext~    198   102 none       brown      yellow          NA   male  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

En donde encontramos nuevamente a Jabba como el personaje mas pesado de
las sagas Star Wars.

## 3. Función select()

Esta función nos permite seleccionar un conjunto de variables de interés
(numero de columnas). Si queremos entenderlo fácilmente, hace un
filtrado de las columnas con las que queramos trabajar para tener una
mejor visualización (esto especialmente cierto si la base de datos
presenta mucha información o son variables no importantes para nuestros
análisis)

De igual manera que las otras funciones, para utilizarla solo la
escribimos, colocamos el nombre de la base de datos que estamos
estudiando (siempre en la primera posición), para luego escribir el
nombre de la variable que queramos seleccionar. Por ejemplo, si queremos
solo seleccionar el nombre del personaje y el color de sus ojos, seria
de la siguiente manera:

``` r
dplyr::select(starwars, name, eye_color)
```

    ## # A tibble: 87 x 2
    ##    name               eye_color
    ##    <chr>              <chr>    
    ##  1 Luke Skywalker     blue     
    ##  2 C-3PO              yellow   
    ##  3 R2-D2              red      
    ##  4 Darth Vader        yellow   
    ##  5 Leia Organa        brown    
    ##  6 Owen Lars          blue     
    ##  7 Beru Whitesun lars blue     
    ##  8 R5-D4              red      
    ##  9 Biggs Darklighter  brown    
    ## 10 Obi-Wan Kenobi     blue-gray
    ## # ... with 77 more rows

Podemos seleccionar cuantas columnas(variables queramos).Ejemplo:

``` r
dplyr::select(starwars, name, eye_color, mass, height, hair_color)
```

    ## # A tibble: 87 x 5
    ##    name               eye_color  mass height hair_color   
    ##    <chr>              <chr>     <dbl>  <int> <chr>        
    ##  1 Luke Skywalker     blue         77    172 blond        
    ##  2 C-3PO              yellow       75    167 <NA>         
    ##  3 R2-D2              red          32     96 <NA>         
    ##  4 Darth Vader        yellow      136    202 none         
    ##  5 Leia Organa        brown        49    150 brown        
    ##  6 Owen Lars          blue        120    178 brown, grey  
    ##  7 Beru Whitesun lars blue         75    165 brown        
    ##  8 R5-D4              red          32     97 <NA>         
    ##  9 Biggs Darklighter  brown        84    183 black        
    ## 10 Obi-Wan Kenobi     blue-gray    77    182 auburn, white
    ## # ... with 77 more rows

Nota: Es importante notas que podemos aprovechar para cambiar el orden
en la que queremos que aparezcan las columnas, eso lo definirá en
relación al orden que le demos al escribir el código. Por ejemplo, si
cambiamos el orden en el código anterior, obtendremos un resultado
diferente:

``` r
dplyr::select(starwars, eye_color, height, hair_color, name, mass)
```

    ## # A tibble: 87 x 5
    ##    eye_color height hair_color    name                mass
    ##    <chr>      <int> <chr>         <chr>              <dbl>
    ##  1 blue         172 blond         Luke Skywalker        77
    ##  2 yellow       167 <NA>          C-3PO                 75
    ##  3 red           96 <NA>          R2-D2                 32
    ##  4 yellow       202 none          Darth Vader          136
    ##  5 brown        150 brown         Leia Organa           49
    ##  6 blue         178 brown, grey   Owen Lars            120
    ##  7 blue         165 brown         Beru Whitesun lars    75
    ##  8 red           97 <NA>          R5-D4                 32
    ##  9 brown        183 black         Biggs Darklighter     84
    ## 10 blue-gray    182 auburn, white Obi-Wan Kenobi        77
    ## # ... with 77 more rows

La función delay es muy versátil y se le pueden añadir diversos
argumentos para aumentar la especificidad en la búsqueda. Algunos
argumentos son (estos argumentos van dentro de la función select()):

-   starts\_with(“ma”)) : la función “starts\_with” buscara todas las
    columnas del data que empiecen por “ma”.
-   ends\_with(“or”)) : la función “ends\_with” buscara todas las
    columnas que terminan en “or”.
-   contains(“s”)) : la función “contains” buscara todas las columnas
    que tienen una “s” en su nombre. La “s” solo tiene que estar en la
    palabra, al comienzo, al medio o final es indiferentemente.
-   num\_range(“x”, 1:5)): Busca variables que comienzan con x,
    continuado por los números del 1 al 5. Como por ejemplo “x1”.
    Siempre podemos utilizar el comando *?select* en la consola de R
    para tener mas información acerca de la función. Así mismo, podemos
    ver tutoriales o buscar mas información en los canales de ayuda o
    google.

## 4. Función mutate()

Utilizamos esta función para añadir variables a nuestra base de datos
original. Generalmente le damos un nuevo nombre a esta variable así como
una regla para calcular los valores que tomará dependiendo casi siempre
de las demás variables. Es decir, creamos una nueva columna en función
de las ya existentes. Las nuevas columnas generadas se añadirán por
defecto al final de la base de datos. Generalmente la nueva variable
toma valores en relación a cálculos matemáticos que realizamos con las
variables ya presentes en la base de datos. Por ejemplo, supongamos que
en la base de starwars queremos crear una nueva variable llamada
Coeficiente\_masa\_altura (que resumiremos como CMA). Esta nueva
variable sera el resultado de dividir la masa de los personajes sobre el
peso para cada uno de ellos:

``` r
dplyr::mutate(starwars, CMA = mass/height)
```

    ## # A tibble: 87 x 15
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO    167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 R2-D2     96    32 <NA>       white, bl~ red             33   none  mascu~
    ##  4 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Leia~    150    49 brown      light      brown           19   fema~ femin~
    ##  6 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  7 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  8 R5-D4     97    32 <NA>       white, red red             NA   none  mascu~
    ##  9 Bigg~    183    84 black      light      brown           24   male  mascu~
    ## 10 Obi-~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~
    ## # ... with 77 more rows, and 6 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>, CMA <dbl>

Se puede visualizar que la ultima columna es ahora CMA y se han
calculado los valores para cada uno de los personajes en relación con su
peso y altura.

Esta función es muy útil para calcular valores de interés que pueden
calcularse a partir de los valores de nuestra base de estudio original.
La función mutate() tiene una función muy cercana llamada transmute().
Esta función realiza lo mismo que mutate() pero elimina todas las demás
variables del resultado final, quedándose solo con aquellas que le
indicamos.

``` r
dplyr::transmute(starwars, name = name, CMA = mass/height)
```

    ## # A tibble: 87 x 2
    ##    name                 CMA
    ##    <chr>              <dbl>
    ##  1 Luke Skywalker     0.448
    ##  2 C-3PO              0.449
    ##  3 R2-D2              0.333
    ##  4 Darth Vader        0.673
    ##  5 Leia Organa        0.327
    ##  6 Owen Lars          0.674
    ##  7 Beru Whitesun lars 0.455
    ##  8 R5-D4              0.330
    ##  9 Biggs Darklighter  0.459
    ## 10 Obi-Wan Kenobi     0.423
    ## # ... with 77 more rows

Como se puede visualizar podemos añadir la variable “name” e igualarla a
“name” lo cual no cambiara nada de la variable pero permitirá
visualizarla. Así como las demás funciones estudiadas, no hay limite en
el numero de variables que podamos poner en una sola función.

## 5 y 6. Función summarise() y group\_by()

Colocamos estas dos funciones en un mismo titulo ya que trabajan casi
siempre en conjunto. La función summarise() nos permite realizar
operaciones dentro de cada columna (variable). Esta función es muy útil
para calcular estadísticos, como la mediana, la media, la desviación
estándar, entre otros. Por ejemplo, si queremos calcular el peso
promedio de todos los personajes de Star Wars:

``` r
dplyr::summarise(starwars, Peso_Promedio = mean(mass))
```

    ## # A tibble: 1 x 1
    ##   Peso_Promedio
    ##           <dbl>
    ## 1            NA

Fíjese que el calculo ha resultado igual a NA, esto es debido a que
basta con que exista un personaje con NA o “dato perdido” para que el
calculo de como resultado NA. Una manera de eliminar los NA dentro de
nuestro código es añadiendo dentro del argumento “na.rm = T” (rm =
remove):

``` r
dplyr::summarise(starwars, Peso_Promedio = mean(mass, na.rm =T))
```

    ## # A tibble: 1 x 1
    ##   Peso_Promedio
    ##           <dbl>
    ## 1          97.3

En esta ocasión se eliminaron los valores NA para el calculo, teniendo
como resultado 97.31186 para el peso promedio de todos los personajes de
starwars.

Sin embargo, y dependiendo de la riqueza de nuestra base de datos, no
solo queremos saber el peso promedio de todos los personajes, sino que
también queremos averiguar por ejemplo, el peso promedio de los
personajes en función a su color de ojos. Es en estos casos donde la
función group\_by() tiene un papel decisivo. Se utiliza en el siguiente
ejemplo (tenemos necesariamente que guardar el resultado del
agrupamiento en una variable):

``` r
Agrupado_por_colorojos <- dplyr::group_by(starwars,eye_color)
```

A esta nueva base de datos podemos aplicar la función summarise():

``` r
dplyr::summarise(Agrupado_por_colorojos, Peso_Promedio = mean(mass, na.rm =T))
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

    ## # A tibble: 15 x 2
    ##    eye_color     Peso_Promedio
    ##    <chr>                 <dbl>
    ##  1 black                  76.3
    ##  2 blue                   86.5
    ##  3 blue-gray              77  
    ##  4 brown                  66.1
    ##  5 dark                  NaN  
    ##  6 gold                  NaN  
    ##  7 green, yellow         159  
    ##  8 hazel                  66  
    ##  9 orange                282. 
    ## 10 pink                  NaN  
    ## 11 red                    81.4
    ## 12 red, blue             NaN  
    ## 13 unknown                31.5
    ## 14 white                  48  
    ## 15 yellow                 81.1

Podemos visualizar ahora claramente que se ha realizado el calculo de
peso promedio en función al grupo al que pertenecen.

Nota: Podemos realizar agrupamientos con la función group\_by()con mas
de una sola variable. Así mismo, podemos calcular más de un valor
estadístico con la función summarise(). Por ejemplo:

``` r
Para <- dplyr::group_by(starwars,eye_color, hair_color)
dplyr::summarise(Para, PesoP = mean(mass, na.rm=T),
                 AlturaP = mean(height, na.rm=T))
```

    ## `summarise()` regrouping output by 'eye_color' (override with `.groups` argument)

    ## # A tibble: 35 x 4
    ## # Groups:   eye_color [15]
    ##    eye_color hair_color   PesoP AlturaP
    ##    <chr>     <chr>        <dbl>   <dbl>
    ##  1 black     none          76.7    186.
    ##  2 black     <NA>          74      173 
    ##  3 blue      auburn       NaN      150 
    ##  4 blue      auburn, grey NaN      180 
    ##  5 blue      black         53.1    168 
    ##  6 blue      blond         80.5    177.
    ##  7 blue      brown        104.     195.
    ##  8 blue      brown, grey  120      178 
    ##  9 blue      none          64.5    185 
    ## 10 blue      white        NaN      167 
    ## # ... with 25 more rows

#### Nota importante.

Para variables principalmente cualitativas sera muy importante tener en
cuenta la función “n()” la cual contará el numero de veces (frecuencia)
que se repite una variable específicamente (generalmente usado para
variables cualitativas o categóricas). Ejemplo:

``` r
dplyr::summarise(Para, frecuencia = n())
```

    ## `summarise()` regrouping output by 'eye_color' (override with `.groups` argument)

    ## # A tibble: 35 x 3
    ## # Groups:   eye_color [15]
    ##    eye_color hair_color   frecuencia
    ##    <chr>     <chr>             <int>
    ##  1 black     none                  9
    ##  2 black     <NA>                  1
    ##  3 blue      auburn                1
    ##  4 blue      auburn, grey          1
    ##  5 blue      black                 2
    ##  6 blue      blond                 3
    ##  7 blue      brown                 7
    ##  8 blue      brown, grey           1
    ##  9 blue      none                  3
    ## 10 blue      white                 1
    ## # ... with 25 more rows

Nota: hay otros comando específicos que aprenderemos en R conforme
avancemos en el curso.

## 7. Función rename()

Podemos utilizar la función rename() para fácilmente modificar el nombre
de una variable. Esto es muy beneficioso cuando trabajamos en lenguaje
de programación debido a que muchas veces las variables tienen nombres
muy largos que impiden trabajar cómodamente o incluso nos permite
traducir un nombre para un fácil entendimiento.

Si queremos por ejemplo renombrar la variable “name” por “nombre” en la
base de datos de starwars

``` r
dplyr::rename(starwars, Nombre = name)
```

    ## # A tibble: 87 x 14
    ##    Nombre height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>   <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke ~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO     167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 R2-D2      96    32 <NA>       white, bl~ red             33   none  mascu~
    ##  4 Darth~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Leia ~    150    49 brown      light      brown           19   fema~ femin~
    ##  6 Owen ~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  7 Beru ~    165    75 brown      light      blue            47   fema~ femin~
    ##  8 R5-D4      97    32 <NA>       white, red red             NA   none  mascu~
    ##  9 Biggs~    183    84 black      light      brown           24   male  mascu~
    ## 10 Obi-W~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Podemos realizar para múltiples variables, solo hay que separar por “,”
en el código para diferenciar:

``` r
dplyr::rename(starwars, Nombre = name, Peso = mass)
```

    ## # A tibble: 87 x 14
    ##    Nombre height  Peso hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>   <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke ~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 C-3PO     167    75 <NA>       gold       yellow         112   none  mascu~
    ##  3 R2-D2      96    32 <NA>       white, bl~ red             33   none  mascu~
    ##  4 Darth~    202   136 none       white      yellow          41.9 male  mascu~
    ##  5 Leia ~    150    49 brown      light      brown           19   fema~ femin~
    ##  6 Owen ~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  7 Beru ~    165    75 brown      light      blue            47   fema~ femin~
    ##  8 R5-D4      97    32 <NA>       white, red red             NA   none  mascu~
    ##  9 Biggs~    183    84 black      light      brown           24   male  mascu~
    ## 10 Obi-W~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~
    ## # ... with 77 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Resaltar que las demás variables permanecen iguales.

# B. Utilizando pipes : %&gt;% (Ctrl + M)

Después de repasar las funciones principales del paquete dplyr, llegamos
a uno de sus operadores emblemas y mas importantes de estudiar. Si
queremos traducirlo, lo llamaríamos el operado tubería, pero es mas
conocido como el operador “pipe”. Este operado, representado por el
símbolo **%&gt;%** nos permite realizar una concatenación de funciones a
una misma base de datos. Para entender mejor, el siguiente ejemplo. De
nuestra base de datos starwars, imaginemos que queremos seleccionar las
variables de nombre, color de ojos y peso corporal e inmediatamente
después realizar un filtrado de aquellos personajes con ojos de color
azul. Si queremos realizarlo en una linea de código, seria de la
siguiente manera:

``` r
dplyr::filter((dplyr::select(starwars, name, eye_color, mass)), eye_color == "blue")
```

    ## # A tibble: 19 x 3
    ##    name               eye_color  mass
    ##    <chr>              <chr>     <dbl>
    ##  1 Luke Skywalker     blue       77  
    ##  2 Owen Lars          blue      120  
    ##  3 Beru Whitesun lars blue       75  
    ##  4 Anakin Skywalker   blue       84  
    ##  5 Wilhuff Tarkin     blue       NA  
    ##  6 Chewbacca          blue      112  
    ##  7 Jek Tono Porkins   blue      110  
    ##  8 Lobot              blue       79  
    ##  9 Mon Mothma         blue       NA  
    ## 10 Qui-Gon Jinn       blue       89  
    ## 11 Finis Valorum      blue       NA  
    ## 12 Ric Olié           blue       NA  
    ## 13 Adi Gallia         blue       50  
    ## 14 Mas Amedda         blue       NA  
    ## 15 Cliegg Lars        blue       NA  
    ## 16 Luminara Unduli    blue       56.2
    ## 17 Barriss Offee      blue       50  
    ## 18 Jocasta Nu         blue       NA  
    ## 19 Tarfful            blue      136

Si bien el código funciona, esto se volverían muy engorroso si es que
quisiéramos aparte hacer una agrupación (group\_by()) y luego un
summarise. Ante esta situación se creo el operador “pipe”, el cual
realiza el proceso opuesto y sacamos la base de datos afuera para luego
realizar la siguiente operación. Por ejemplo, el procedimiento anterior,
pero con el operador %&gt;% :

``` r
starwars %>% 
        dplyr::select(name, eye_color, hair_color, mass) %>%
        dplyr::filter(eye_color == "blue")
```

    ## # A tibble: 19 x 4
    ##    name               eye_color hair_color    mass
    ##    <chr>              <chr>     <chr>        <dbl>
    ##  1 Luke Skywalker     blue      blond         77  
    ##  2 Owen Lars          blue      brown, grey  120  
    ##  3 Beru Whitesun lars blue      brown         75  
    ##  4 Anakin Skywalker   blue      blond         84  
    ##  5 Wilhuff Tarkin     blue      auburn, grey  NA  
    ##  6 Chewbacca          blue      brown        112  
    ##  7 Jek Tono Porkins   blue      brown        110  
    ##  8 Lobot              blue      none          79  
    ##  9 Mon Mothma         blue      auburn        NA  
    ## 10 Qui-Gon Jinn       blue      brown         89  
    ## 11 Finis Valorum      blue      blond         NA  
    ## 12 Ric Olié           blue      brown         NA  
    ## 13 Adi Gallia         blue      none          50  
    ## 14 Mas Amedda         blue      none          NA  
    ## 15 Cliegg Lars        blue      brown         NA  
    ## 16 Luminara Unduli    blue      black         56.2
    ## 17 Barriss Offee      blue      black         50  
    ## 18 Jocasta Nu         blue      white         NA  
    ## 19 Tarfful            blue      brown        136

Obtenemos el mismo resultado, pero en un código mas limpio. Iniciamos
siempre de la base de datos y vamos sumándole funciones (el orden de las
funciones determina el resultado final y depende del investigador y los
objetivos). Si queremos ahora hacer una agrupación y cálculos de
estadísticos, podemos escribir el siguiente código:

``` r
starwars %>% 
        dplyr::select(name, eye_color, hair_color, mass) %>%
        dplyr::filter(eye_color == "blue") %>% 
        dplyr::group_by(hair_color) %>% 
        dplyr::summarise(Peso_Promedio = mean(mass, na.rm = T))
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

    ## # A tibble: 8 x 2
    ##   hair_color   Peso_Promedio
    ##   <chr>                <dbl>
    ## 1 auburn               NaN  
    ## 2 auburn, grey         NaN  
    ## 3 black                 53.1
    ## 4 blond                 80.5
    ## 5 brown                104. 
    ## 6 brown, grey          120  
    ## 7 none                  64.5
    ## 8 white                NaN

El resultado nos da el peso promedio de los personajes que tiene ojos
color azul en función a su color de pelo. Nota: Cuando se usar el
operador %&gt;% ya no tenemos que colocar la base de datos una y otra
vez en el primer argumento de cada función, esto se realiza de manera
automática.

# C. Tratamiento de NA

Como hemos visto, podemos colocar na.rm = T, cada vez que hagamos uso de
una función especifico. Sin embargo, una manera práctica de eliminar los
NA también es eliminarlos inicialmente (limpieza de datos) para que no
interfiera en los cálculos. Esto lo podemos realizar fácilmente con la
función filter()

``` r
dplyr::filter(starwars, !is.na(eye_color), !is.na(hair_color))
```

    ## # A tibble: 82 x 14
    ##    name  height  mass hair_color skin_color eye_color birth_year sex   gender
    ##    <chr>  <int> <dbl> <chr>      <chr>      <chr>          <dbl> <chr> <chr> 
    ##  1 Luke~    172    77 blond      fair       blue            19   male  mascu~
    ##  2 Dart~    202   136 none       white      yellow          41.9 male  mascu~
    ##  3 Leia~    150    49 brown      light      brown           19   fema~ femin~
    ##  4 Owen~    178   120 brown, gr~ light      blue            52   male  mascu~
    ##  5 Beru~    165    75 brown      light      blue            47   fema~ femin~
    ##  6 Bigg~    183    84 black      light      brown           24   male  mascu~
    ##  7 Obi-~    182    77 auburn, w~ fair       blue-gray       57   male  mascu~
    ##  8 Anak~    188    84 blond      fair       blue            41.9 male  mascu~
    ##  9 Wilh~    180    NA auburn, g~ fair       blue            64   male  mascu~
    ## 10 Chew~    228   112 brown      unknown    blue           200   male  mascu~
    ## # ... with 72 more rows, and 5 more variables: homeworld <chr>, species <chr>,
    ## #   films <list>, vehicles <list>, starships <list>

Esto eliminara todos los individuos de estudio (personajes de starwars)
que no tenían definido el color de ojo, ni de pelo en la base original
de starwars.

El manejo de los “missing value” o datos perdidos, sera un tema que
veremos recurrentemente a los largo del curso y se vera a mas detalle
las implicancias de eliminar sujetos dentro de una base y sus
consecuencias en el análisis.

## EJERCICIOS

-   Los ejercicios están diseñados para trabajar con la base de datos de
    starwars, sin embargo, usted podría aprovechar para usar cualquiera
    de las bases de datos de cualquiera de los paquetes de R. Las puede
    visualizar en el link
    <https://vincentarelbundock.github.io/Rdatasets/datasets.html>

##### 1. Seleccione las variables name, gender, species y homeworld de la base de datos starwars (la cual se encuentra dentro del paquete dplyr, activelo antes y cargue la base de datos en su ambiente de trabajo). Asigne esta seleccion de variables en una nueva variable (asigne el nombre a esta variable de su gusto)

##### 2. Filtre todos los personajes femeninos de la base de datos starwars (asignelos a una nueva variable).

##### 3. Filtre en una linea de codigo todos los personajes femeninos que tengan un peso mayor a 60 kilogramos.

##### 4. Arregle la base de datos y muestre a los personajes de starwars del mas joven al mas viejo.

##### 5. Agrupe y luego genere una nueva variable en la base de datos de tal manera que obtengamos el peso medio de todos los personajes masculinos por especie (acuerdese siempre de asignar el resultado a una nueva variable y en este caso acuerdese de empezar a utilizar el operador *pipe* %&gt;%).

##### 6. Cambie el nombre de todas las variables de la base de datos starwars, del ingles al español (asigne esta nueva versión a una nueva variable)

##### 7. A partir de la base de datos en español creada en el ejercicio 6, cree una nueva base de datos con las siguientes características:

-   Solo deben de estar las variables: Nombre, genero, especie, color de
    piel, color de ojos, altura y peso.
-   Filtre todos los personajes con color de ojos amarillo, rojo,
    naranja y marrón.

##### 8. A partir de la base de datos en español creada en el ejercicio 6, cree una nueva base de datos con las siguientes caracteristicas:

-   Solo deben de estar las variables: Nombre, genero, especie, mundo de
    origen (homeworld), altura y peso.
-   Encuentre el peso promedio de los personajes según su especie.
-   Encuentre la mediana de los personajes según su especie
-   Encuentre el valor máximo y mínimo de cada especie.
